<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Shared Canvas</title>
<style>
  html, body {
    height:100%; margin:0;
    background: linear-gradient(180deg,#071022,#07101a);
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    font-family:system-ui; color:#fff;
  }
  .controls { display:flex; gap:10px; align-items:center; margin-bottom:10px; }
  .btn { background:linear-gradient(90deg,#0ea5a4,#7c3aed); color:white; padding:8px 12px; border-radius:8px; border:0; cursor:pointer; font-weight:600; }
  .panel { width:90vw; max-width:1200px; height:calc(90vw / 6); max-height:200px; border-radius:12px; overflow:hidden; position:relative; box-shadow:0 18px 50px rgba(2,6,23,0.7); }
  canvas { display:block; width:100%; height:100%; background:#ffffff; cursor:crosshair; }
  .link { margin-top:12px; color:#06b6d4; text-decoration:none; font-weight:bold; }
</style>
</head>
<body>

<div class="controls">
  <label>Color <input id="color" type="color" value="#06b6d4" style="margin-left:8px"></label>
  <label style="margin-left:8px">Size <input id="size" type="range" min="1" max="80" value="6" style="margin-left:8px"></label>
  <button id="eraser" class="btn">Eraser</button>
  <button id="clear" class="btn">Clear</button>
</div>

<div class="panel" id="panel">
  <canvas id="canvas"></canvas>
</div>

<a class="link" href="https://mtch3000.github.io/draw/" target="_blank">https://mtch3000.github.io/draw/</a>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onChildAdded, push, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyBFc597khPRThMIGF4BRkqA7VxnNEM0zFk",
    authDomain: "shared-drawing-canvas.firebaseapp.com",
    databaseURL: "https://shared-drawing-canvas-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "shared-drawing-canvas",
    storageBucket: "shared-drawing-canvas.firebasestorage.app",
    messagingSenderId: "379615731075",
    appId: "1:379615731075:web:113fea60f358360975aab6"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const drawRef = ref(db, "drawings");

const canvas = document.getElementById('canvas');
const panel = document.getElementById('panel');
const ctx = canvas.getContext('2d');
const colorInput = document.getElementById('color');
const sizeInput = document.getElementById('size');
const clearBtn = document.getElementById('clear');
const eraserBtn = document.getElementById('eraser');

let drawing = false, last = {x:0,y:0}, isEraser = false;

function resize(){
  const ratio = window.devicePixelRatio || 1;
  const rect = panel.getBoundingClientRect();
  canvas.width = rect.width * ratio;
  canvas.height = rect.height * ratio;
  ctx.scale(ratio, ratio);
  ctx.lineCap = "round";
  ctx.lineJoin = "round";
  ctx.fillStyle = "#fff";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}
resize();
window.addEventListener('resize', resize);

function getPos(e){
  const rect = canvas.getBoundingClientRect();
  const t = e.touches ? e.touches[0] : e;
  return {x: t.clientX - rect.left, y: t.clientY - rect.top};
}

function drawLine(data){
  ctx.lineWidth = data.size;
  ctx.strokeStyle = data.erase ? "rgba(0,0,0,1)" : data.color;
  ctx.globalCompositeOperation = data.erase ? "destination-out" : "source-over";
  ctx.beginPath();
  ctx.moveTo(data.from.x, data.from.y);
  ctx.lineTo(data.to.x, data.to.y);
  ctx.stroke();
}

function pointerDown(e){ e.preventDefault(); drawing = true; last = getPos(e); }
function pointerMove(e){
  if(!drawing) return;
  const pos = getPos(e);
  const line = {from:last, to:pos, color:colorInput.value, size:+sizeInput.value, erase:isEraser};
  drawLine(line);
  push(drawRef, line);
  last = pos;
}
function pointerUp(){ drawing = false; }

canvas.addEventListener("mousedown", pointerDown);
canvas.addEventListener("mousemove", pointerMove);
window.addEventListener("mouseup", pointerUp);
canvas.addEventListener("touchstart", pointerDown, {passive:false});
canvas.addEventListener("touchmove", pointerMove, {passive:false});
window.addEventListener("touchend", pointerUp);

eraserBtn.addEventListener("click", ()=>{
  isEraser = !isEraser;
  eraserBtn.textContent = isEraser ? "Draw" : "Eraser";
});

clearBtn.addEventListener("click", ()=>{
  remove(drawRef);        // clears database
  ctx.fillStyle = "#fff"; // clears canvas
  ctx.fillRect(0,0,canvas.width,canvas.height);
});

// Draw existing lines from Firebase
onChildAdded(drawRef, (snapshot)=>{
  const data = snapshot.val();
  drawLine(data);
});
</script>
</body>
</html>
